# ETL simple
*etl_script.py* представляет из себя Extract-Transform-Load скрипт, работающий с разными форматами файлов: `.csv`, `.json`, и `.xml`. Скрипт производит извлечение и парсинг данных из файлов, преобразование данных и их запись в файл в формате `.tsv`.  
  
Директории:  
*data* - файлы с данными различных форматов;  
*inf* - README файл с описанием задания;  
*results* - примеры результатов и результаты, полученные после работы скрипта, в формате `.tsv`.  

## Класс ExtractTransformLoad

Реализует извлечение данных из файлов следующих форматов: `.csv`, `.json`, `.xml`. Преобразует полученные данные и загружает преобразованные данные в файл в табличном формате `.tsv`.  
    
    ```
    etl = ExtractTransformLoad()    # Создание экземпляра класса
    ```

+ **Инициализация**
  
Метод `__init__` инициализирует следующие атрибуты:  
  
`row` - список, в который из файлов c данными записываются строки со значениями в виде словарей (где ключ - это имя столбца, значение - соответствующее значение строки или числа в строке);  
`columns` - множество, в котором хранятся названия всех колонок из всех файлов с данными;  
`common_columns` - список, в котором хранятся множества с именами столбцов из каждого файла с данными.  

+ **Чтение csv**  (read_csv) 
  
Метод `read_csv` реализует чтение и парсинг данных из файлов в формате `.csv`.  
Обновляет атрибуты в соответствии с прочитанными данными.  
Принимает параметр:  
  
`path` - *str type* путь к файлу с данными в формате `.csv`.  
  
    ```
    etl.read_csv('data/data_file.csv')    # Пример запуска метода
    ```
  
+ **Чтение json**  (read_json) 
  
Метод `read_json` реализует чтение и парсинг данных из файлов в формате `.json`.  
Обновляет атрибуты в соответствии с прочитанными данными.  
Принимает параметр:  
  
`path` - *str type* путь к файлу с данными в формате `.json`.  
  
    ```
    etl.read_json('data/data_file.json')    # Пример запуска метода
    ```

+ **Чтение xml**  (read_xml) 
  
Метод `read_xml` реализует чтение и парсинг данных из файлов в формате `.xml`.  
Обновляет атрибуты в соответствии с прочитанными данными.  
Принимает параметр:  
  
`path` - *str type* путь к файлу с данными в формате `.xml`.  
  
    ```
    etl.read_xml('data/data_file.xml')    # Пример запуска метода
    ```

+ **Сортировка D- и M-колонок**  (d_m_sorted_columns) 
  
Свойство `d_m_sorted_columns` реализует сегментирование атрибута *columns* на D- и M-столбцы и сортировку каждого из полученных столбцов.  
Возвращает 2 кортежа с D-столбцами и M-столбцами соответственно.  

+ **Пересечение и сортировка D- и M-колонок**  (d_m_sorted_common_columns) 
  
Свойство `d_m_sorted_common_columns` реализует сегментирование на D- и M-столбцы пересечения имен столбцов из атрибута *common_columns* и сортировку каждого из полученных столбцов.  
Возвращает 2 кортежа с D столбцами и M столбцами соответственно.  

+ **Запись tsv (базовая)**  (write_tsv_basic) 
  
Метод `write_tsv_basic` реализует преобразование (базовое) считанных из всех файлов данных и их запись в файл в формате `.tsv`. Данные в выходном файле отсортированы по столбцу *D1*.  
Принимает параметры:  
  
`path` - *str type* путь к имени выходного файла в формате `.tsv`;  
`common_columns` - *bool type* определяет состояние столбцов в выходном файле:  
если `True` - в выходном файле будут только те столбцы, которые пересекаются во всех файлах с данными;  
если `False` - в выходном файле будут все столбцы, которые есть во всех файлах с данными.  
  
Примеры запуска метода:  
  
    ```
    etl.write_tsv_basic('results/res_basic_all.tsv', common_columns=False)
    etl.write_tsv_basic('results/res_basic_union.tsv', common_columns=True)
    ```
  
+ **Получение продвинутых данных**  (get_data_advanced) 
  
Метод `get_data_advanced` реализует преобразование данных для продвинутой записи. Данные группируются по уникальным значениям комбинаций строк из столбцов *D1...Dn* и вычисляются суммы соответствующих значений из столбцов *M1...Mn*.  
Возвращает *словарь* с преобразованными данными, где ключи - это кортежи уникальных комбинаций значений из столбцов *D1...Dn*, значения - это кортежи соответствующих сумм значений из столбцов *M1...Mn*.  
Принимает параметры:  
  
`d_columns` - *tuple type* отсортированный кортеж с именами столбцов *D1...Dn*;  
`m_columns` - *tuple type* отсортированный кортеж с именами столбцов *M1...Mn*.  
  
+ **Запись tsv (продвинутая)**  (write_tsv_advanced) 
  
Метод `write_tsv_advanced` реализует преобразование (расширенное) считанных из всех файлов данных и их запись в файл в формате `.tsv`. Столбцы *MS1...MSn* содержат суммы значений соответствующих *M1...Mn* из всех файлов, сгруппированные по уникальным значениям комбинаций строк из *D1...Dn*.  
Принимает параметры:  
  
`path` - *str type* путь к имени выходного файла в формате `.tsv`;  
`common_columns` - *bool type* определяет состояние столбцов в выходном файле:  
если `True` - в выходном файле будут только те столбцы, которые пересекаются во всех файлах с данными;  
если `False` - в выходном файле будут все столбцы, которые есть во всех файлах с данными.  
  
Примеры запуска метода:  
  
    ```
    etl.write_tsv_advanced('results/res_advanced_all.tsv', common_columns=False)
    etl.write_tsv_advanced('results/res_advanced_union.tsv', common_columns=True)
    ```
  
+ **Обработка ошибок**
При чтении файлов, в которых имеются некорректные значения в строках, пользователь получает сообщение об ошибке с указанием детальной информации о проблемном значении без прекращения выполнения программы. В результирующем файле вместо такого значения в соответствующую ячейку таблицы будет записано значение: `'-'`

  
## Запуск скрипта

Для корректной работы программы скрипт необходимо запускать с использованием интерпретатора **Python версии от 3.7 и выше**. Из корневой папки проекта выполните следующие команды в терминале:  
`python3 test_etl.py` или `./test_etl.py` - запуск тестов;  
`python3 etl_script.py` или `./etl_script.py` - запуск скрипта ETL.
